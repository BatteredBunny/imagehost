<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/public/styles/common.css">
    <link rel="stylesheet" href="/public/styles/user.css">
    <link rel="shortcut icon" href="/public/favicon.ico" type="image/x-icon">
    <title>User</title>
    <meta name="description" content="The best file host on all of interwebs">
</head>

<body>
    {{ template "topbar.gohtml" . }}

    <div class="container">
        <h1>User</h1>

        <div id="social-login" class="setting-group">
            <h2>Social login</h2>

            {{ if .UnlinkedAccount }}
            <div class="warning-modal">
                <p>Link your account with at least one platform otherwise you won't be able to login after this!</p>
            </div>
            {{ end }}

            {{ if .LinkedWithGithub }}
            <a href="https://github.com/{{ .GithubUsername }}" target="_blank" class="linked-account">
                <svg class="feather-icon">
                    <use href="/public/assets/feather-sprite.svg#github" />
                </svg>
                <span>{{ .GithubUsername }}</span>
            </a>
            {{ else }}
            <p><a href="/api/auth/link/github">Link with github</a></p>
            {{ end }}
        </div>

        <div id="files" class="setting-group">
            <h2>Files</h2>
            <p>{{ .FilesCount }} file{{ if ne .FilesCount 1 }}s{{ end }} uploaded, totalling <span title="{{ .FilesSizeTotal }} bytes">{{ humanizeBytes .FilesSizeTotal }}</span></p>
            <div class="file-grid">
                {{ range .Files }}
                <div class="file-entry">
                    <a href="/{{ .FileName }}" class="file-link">
                        <div class="file-thumbnail">
                            {{ if mimeIsImage .MimeType }}
                            <img src="/{{ .FileName }}" alt="Uploaded image">
                            {{ else if mimeIsVideo .MimeType }}
                            <video src="/{{ .FileName }}" alt="Uploaded video">
                            {{ else if mimeIsAudio .MimeType }}
                            <div class="file-icon">
                                <svg class="feather-icon">
                                    <use href="/public/assets/feather-sprite.svg#music" />
                                </svg>
                            </div>
                            {{ else }}
                            <div class="file-icon">
                                <svg class="feather-icon">
                                    <use href="/public/assets/feather-sprite.svg#file" />
                                </svg>
                            </div>
                            {{ end }}
                        </div>
                        <div class="file-name">{{ .FileName }}</div>
                    </a>

                    <div class="file-info">
                        {{ if formatTimeDate .ExpiryDate }}
                        <div class="expires-info" title="{{ formatTimeDate .ExpiryDate }}">
                            <svg class="feather-icon">
                                <use href="/public/assets/feather-sprite.svg#trash-2" />
                            </svg>
                            <span>{{ relativeTime .ExpiryDate }}</span>
                        </div>
                        {{ end }}

                        <div class="views">
                            <svg class="feather-icon">
                                <use href="/public/assets/feather-sprite.svg#eye" />
                            </svg>
                            <span>{{ .Views }} view</span>
                        </div>

                        <div class="file-size" title="{{ .FileSize }} bytes">
                            <svg class="feather-icon">
                                <use href="/public/assets/feather-sprite.svg#hard-drive" />
                            </svg>
                            <span>{{ humanizeBytes .FileSize }}</span>
                        </div>
                    </div>

                    <form class="delete-button-form" action="/api/file/delete" method="POST" enctype="multipart/form-data">
                        <input type="text" name="file_name" value="{{ .FileName }}" hidden>
                        <input class="delete-button" type="submit" value="Delete" data-confirm='Are you sure you want to delete "{{ .FileName }}"?'>
                    </form>
                </div>
                {{ end }}
            </div>
        </div>

        <div id="upload-tokens" class="setting-group">
            <h2>Upload tokens</h2>

            <p>For script usage, its recommended to give programs or scripts specific tokens instead of general ones for
                security purposes.</p>

            <form action="/api/account/new_upload_token" method="POST" enctype="multipart/form-data">
                <input type="text" name="nickname" placeholder="Nickname">
                <input class="create-button" type="submit" value="Create upload token">
            </form>

            {{ if .UploadTokens }}
            <div class="upload-tokens-list">
                {{ range .UploadTokens }}
                <div class="upload-token-entry">
                    <div class="info-row">
                        <div class="nickname">{{ .Nickname }}</div>

                        <div class="extra-info">
                            {{ if .LastUsed }}
                            <div>Last used: <span title="{{ formatTimeDate .LastUsed }}">{{ relativeTime .LastUsed
                                    }}</span></div>
                            {{ else }}
                            <div>Last used: Never</div>
                            {{ end }}

                            <form action="/api/account/delete_upload_token" method="POST" enctype="multipart/form-data">
                                <input type="text" name="upload_token" value="{{ .Token }}" hidden>
                                <input class="delete-button" type="submit" value="Delete" data-confirm="Are you sure you want to delete this upload token?">
                            </form>
                        </div>
                    </div>

                    <div><code>{{ .Token }}</code></div>
                </div>
                {{ end }}
            </div>
            {{ end }}
        </div>

        {{ if .InviteCodes }}
        <div id="invite-codes" class="setting-group">
            <h2>Invite codes</h2>

            <p>Shareable account registration codes on your account. You are soley responsible for any users you invite.
            </p>

            <div class="codes">
                {{ range .InviteCodes }}
                <div class="code">
                    <code class="code-text">{{ .Code }}</code>
                    <div class="info">
                        <div class="uses-left">Uses left {{ .Uses }}</div>
                        <div class="invite-code-expires" title="{{ formatTimeDate .ExpiryDate }}">Expires {{ relativeTime .ExpiryDate }}</div>

                        <form action="/api/account/delete_invite_code" method="POST" enctype="multipart/form-data" >
                            <input type="text" name="invite_code" value="{{ .Code }}" hidden>
                            <input class="delete-button" type="submit" value="Delete" data-confirm="Are you sure you want to delete this invite code?">
                        </form>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <div id="account-settings" class="setting-group">
            <h2>Account</h2>
            <div class="account-settings-button-row">
                <form action="/api/account/delete" method="POST" enctype="multipart/form-data">
                    <input class="delete-button" type="submit" value="Delete my account" data-confirm="Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently deleted.">
                </form>
                <form action="/api/account/delete_all_files" method="POST" enctype="multipart/form-data">
                    <input class="delete-button" type="submit" value="Delete all files" data-confirm="Are you sure you want to delete ALL your files? This action cannot be undone.">
                </form>
            </div>
        </div>
    </div>

    <script src="/public/js/deleteButtonConfirm.js"></script>
</body>

</html>